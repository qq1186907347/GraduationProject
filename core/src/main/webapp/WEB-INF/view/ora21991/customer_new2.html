<#include "../include/header.html">
<script src="${base.contextPath}/common/code?contactsType=HCRM.CONTACTS_TYPE"
        type="text/javascript"></script>
<script src="${base.contextPath}/common/code?contactsSex=HCRM.CONTACTS_SEX"
        type="text/javascript"></script>
<script type="text/javascript">
    var viewModel = Hap.createGridViewModel("#concact-grid",{
        contactsType:contactsType,
        contactsSex:contactsSex,
    });

    var viewModel2 = Hap.createGridViewModel("#product-grid");
</script>
<style>
    .div {
        margin: 0 auto;
        width: 115rem;
        height: 30rem;
    }

    .tab-p {
        height: 1rem;
        font-size: 2rem;
        margin: 0.5rem;
        font-family: "Arial Black", arial-black;
        font-weight: bold;
    }

    .font-p {
        margin: 0 auto;
        color: black;
        font-size: 1.5rem;
    }

    .div-out {
        margin-top: 10px;
    }

    .font-input {
        height: 30px;
        width: 100%;
    }

    .tab-btn {
        float: right;
        margin: 0.5rem;
        font-size: 1.5rem;
        color: #0a001f;
    }
</style>
<body>
<div class="div">

    <div class="titie" style="height: 4rem ;margin-left: 50rem;font-size: 3.5rem;color:black">
        <div class="col-md-5"><@spring.message " customer.new"/></div>
    </div>
    <div class="row " style="height: 4rem">
        <div class="col-md-5 tab-p"><@spring.message "customer.baseinfo"/></div>
    </div>

    <div class="row" style="margin-top: 10px;">
        <div class="col-md-1 font-p div-out"><@spring.message "customer.customercode"/></div>
        <div class="col-md-3 div-out">
            <input type="text" class="font-input">
        </div>
        <div class="col-md-1 font-p div-out"><@spring.message "customer.fullname"/></div>
        <div class="col-md-7 div-out"><input type="text" class="font-input"></div>
    </div>

    <div class="row div-out">
        <div class="col-md-1 font-p"><@spring.message "customer.englishname"/></div>
        <div class="col-md-3">
            <input type="text" class="font-input">
        </div>
        <div class="col-md-1 font-p"><@spring.message "customer.phone"/></div>
        <div class="col-md-3"><input type="text" class="font-input"></div>

        <div class="col-md-1 font-p"><@spring.message "customer.customeramount"/></div>
        <div class="col-md-3"><input type="text" class="font-input"></div>
    </div>

    <div class="row div-out">
        <div class="col-md-1 font-p"><@spring.message "customer.creditcode"/></div>
        <div class="col-md-3">
            <input type="text" class="font-input">
        </div>
        <div class="col-md-1 font-p"><@spring.message "customer.dutyparagraph"/></div>
        <div class="col-md-3"><input type="text" class="font-input"></div>
        <div class="col-md-1 font-p"><@spring.message " customer.website"/></div>
        <div class="col-md-3"><input type="text" class="font-input"></div>
    </div>

    <div class="row div-out">
        <div class="col-md-1 font-p">上级客户</div>
        <div class="col-md-3">
            <input type="text" class="font-input">
        </div>
        <div class="col-md-1 font-p"><@spring.message "customer.company"/></div>
        <div class="col-md-3"><input type="text" class="font-input"></div>
    </div>

    <div class="row div-out">
        <div class="col-md-1 font-p"><@spring.message "customer.regiteraddress"/></div>
        <div class="col-md-1 font-p"><@spring.message "customer.area"/></div>
        <div class="col-md-1 font-p" style="margin-left: -25px"><select id="county" name="area" data-role="combobox"
                                                                        style="height: 25px;width:80px"
                                                                        data-value-primitive="true" required
                                                                        data-text-field="meaning"
                                                                        data-value-field="value"
                                                                        data-bind="source: gradeData, value:model.grade"> </select>
        </div>
        <div class="col-md-1 font-p"><select id="prince" name="area" data-role="combobox"
                                             style="height: 25px;width:80px"
                                             data-value-primitive="true" required
                                             data-text-field="meaning" data-value-field="value"
                                             data-bind="source: gradeData, value:model.grade"> </select></div>
        <div class="col-md-1 font-p"><select id="city" name="city" data-role="combobox" style="height: 25px;width:80px"
                                             data-value-primitive="true" required
                                             data-text-field="meaning" data-value-field="value"
                                             data-bind="source: gradeData, value:model.grade"> </select></div>
        <div class="col-md-1 font-p"><select id="xiang" name="xiang" data-role="combobox"
                                             style="height: 25px;width:80px"
                                             data-value-primitive="true" required
                                             data-text-field="meaning" data-value-field="value"
                                             data-bind="source: gradeData, value:model.grade"> </select></div>
        <div class="col-md-2 font-p" ><@spring.message "customer.detailedaddress"/></div>
        <div class="col-md-3 font-p"><input type="text" class="font-input"></div>
    </div>

    <div class="row div-out">
        <div class="col-md-1 font-p tab-p-bottom" style="height: 7rem;"><@spring.message
            "customer.otherdescription"/>
        </div>
        <div class="col-md-11">
            <textarea type="text" class="font-input" style="height: 7rem"></textarea>
        </div>
    </div>


    <!--产品预估-->
    <div style="margin-top: 2rem">
        <div class="col-md-6" id="toolbar-btn1" style="margin-left: -10px">
            <span class="btn btn-primary k-grid-add" data-hotkey="hotkey_create"
              style="float:left;margin-right:5px;"
              data-bind="click:create"><i class="fa fa-plus-square" style="margin-right:3px;"></i><@spring.message "hap.new"/></span>
            <span class="btn btn-danger" data-bind="click:remove"
                  data-hotkey="hotkey_delete"
                  style="float:left;margin-right:5px;"><i class="fa fa-trash-o" style="margin-right:3px;"></i><@spring.message "hap.delete"/></span>
        </div>
        <script>kendo.bind($('#toolbar-btn1'), viewModel2);</script>
        <div class="col-md-6 row tab-p" style="height: 4rem;"><@spring.message "product.prediction"/></div>
    </div>

    <div style="clear:both">
        <div id="product-grid"></div>
    </div>

    <!--联系人-->
    <div style="margin-top: 2rem">
        <div class="col-md-6" id="toolbar-btn2">
            <span class="btn btn-primary k-grid-add" data-hotkey="hotkey_create"
              style="float:left;margin-right:5px;"
              data-bind="click:create"><i class="fa fa-plus-square" style="margin-right:3px;"></i><@spring.message "hap.new"/></span>
            <span class="btn btn-danger" data-bind="click:remove"
                  data-hotkey="hotkey_delete"
                  style="float:left;margin-right:5px;"><i class="fa fa-trash-o" style="margin-right:3px;"></i><@spring.message "hap.delete"/></span>
        </div>
        <script>kendo.bind($('#toolbar-btn2'), viewModel);</script>
        <div class="col-md-6 row   tab-p" style="height: 4rem;"><@spring.message "concact.person"/></div>
    </div>
    <div style="clear:both">
        <div id="concact-grid"></div>
    </div>
    <!--style="margin-left: 500px;margin-top: 20px"-->
    <div  class="pull-right"  id="toolbar-btn3"style="margin-right: 20px;">
        <span id="query" class="btn btn-primary" style="float:left;width:70px" type="submit" data-bind="click:save"><@spring.message "hap.save" /></span>
        <span id="cancel" class="btn btn-primary" style="float:left;width:70px;margin-left: 30px"><@spring.message "hap.cancel" /></span>
    </div>
    <script>kendo.bind($('#toolbar-btn3'), viewModel);</script>
</div>



<script type="text/javascript">
    Hap.initEnterQuery('#query-form', viewModel.query);
    $('#cancel').click(function () {
        $('#myModal').modal('hide');
    })
    var BaseUrl = _basePath;
    dataSource = new kendo.data.DataSource({
        transport: {
            read: {
                url: BaseUrl + "/hcrm/customer/query",
                type: "POST",
                dataType: "json"
            },
            update: {
                url: BaseUrl + "/hcrm/customer/submit",
                type: "POST",
                contentType: "application/json"
            },
            destroy: {
                url: BaseUrl + "/hcrm/customer/remove",
                type: "POST",
                contentType: "application/json"
            },
            create: {
                url: BaseUrl + "/hcrm/customer/submit",
                type: "POST",
                contentType: "application/json"
            },
            parameterMap: function (options, type) {
                if (type !== "read" && options.models) {
                    var datas = Hap.prepareSubmitParameter(options, type)
                    return kendo.stringify(datas);
                } else if (type === "read") {
                    return Hap.prepareQueryParameter(viewModel.model.toJSON(), options)
                }
            }
        },
        batch: true,
        serverPaging: true,
        pageSize: 10,
        schema: {
            data: 'rows',
            total: 'total',
            model: {
                id: "customerId",
                fields: {}
            }
        }
    });






    /*产品 grid*/
    $("#product-grid").kendoGrid({
        dataSource: dataSource,
        resizable: true,
        scrollable: true,
        navigatable: false,
        selectable: 'multiple, rowbox',
        dataBound: function () {
            if (parent.autoResizeIframe) {
                parent.autoResizeIframe('${RequestParameters.functionCode!}')
            }
        },
        pageable: {
            pageSizes: [5, 10, 20, 50],
            refresh: true,
            buttonCount: 5
        },
        columns: [
            {
                field: "productType",
                title: '<@spring.message "product.producttype"/>',
                width: 120
            },
            {
                field: "levelFirst",
                title: '<@spring.message "product.levelfirst"/>',
                width: 120
            },
            {
                field: "levelSecond",
                title: '<@spring.message "product.levelsecond"/>',
                width: 120
            },
            {
                field: "manDay",
                title: '<@spring.message "product.manday"/>',
                width: 120
            },
            {
                field: "price",
                title: '<@spring.message "product.price"/>',
                width: 120
            },
            {
                field: "totalPrice",
                title: '<@spring.message "product.totalprice"/>',
                width: 120
            },
        ],
        editable: true
    });


    /*联系人 grid*/
    $("#concact-grid").kendoGrid({
        dataSource: dataSource,
        resizable: true,
        scrollable: true,
        toolbar:null,
        navigatable: false,
        selectable: 'multiple, rowbox',
        dataBound: function () {
            if (parent.autoResizeIframe) {
                parent.autoResizeIframe('${RequestParameters.functionCode!}')
            }
        },
        pageable: {
            pageSizes: [5, 10, 20, 50],
            refresh: true,
            buttonCount: 5
        },
        columns: [
            {
                field: "contactType",
                title: '<@spring.message "concact.type"/>',
                width: 120,
                template: function (dataItem) {
                    var v = dataItem.contactType;
                    $.each(contactsType, function(i, n) {
                        if((n.value || '').toLowerCase() == (v || '').toLowerCase()) {
                            v = n.meaning;
                            return v;
                        }
                    });
                    return v;
                },
                editor: function (container, options) {
                    $('<input name = "'+ options.field +'"/>').appendTo(container).kendoDropDownList({
                        dataTextField: "meaning",
                        dataValueField: "value",
                        dataSource: contactsType,
                        change:function(){
                            // 在change事件中设置lovCode的值，并清空lov表单元素的值
                            options.model.set('contactType',this.value());
                          /*  options.model.set('orgId', null);
                            options.model.set('orgName', null);*/
                        }
                    });
                }
            },
            {
                field: "name",
                title: '<@spring.message " concact.name"/>',
                width: 120
            },
            {
                field: "sex",
                title: '<@spring.message "concact.sex"/>',
                width: 120,
                template: function (dataItem) {
                    var v = dataItem.sex;
                    $.each(contactsSex, function(i, n) {
                        if((n.value || '').toLowerCase() == (v || '').toLowerCase()) {
                            v = n.meaning;
                            return v;
                        }
                    });
                    return v;
                },
                editor: function (container, options) {
                    $('<input name = "'+ options.field +'"/>').appendTo(container).kendoDropDownList({
                        dataTextField: "meaning",
                        dataValueField: "value",
                        dataSource: contactsSex,
                        change:function(){
                            // 在change事件中设置lovCode的值，并清空lov表单元素的值
                            options.model.set('sex',this.value());
                            /*  options.model.set('orgId', null);
                              options.model.set('orgName', null);*/
                        }
                    });
                }
            },
            {
                field: "position",
                title: '<@spring.message "concact.job"/>',
                width: 120
            },
            {
                field: "phone",
                title: '<@spring.message "concact.phone"/>',
                width: 120
            },
            {
                field: "tel",
                title: '<@spring.message "concact.pubicphone"/>',
                width: 120
            },
            {
                field: "email",
                title: '<@spring.message "concact.email"/>',
                width: 120
            },
            {
                field: "addressCountry",
                title: '<@spring.message "concact.addresscountry"/>',
                width: 120
            },
            {
                field: "addressProvince",
                title: '<@spring.message "concact.addressprovince"/>',
                width: 120
            },  {
                field: "addressCity",
                title: '<@spring.message "concact.addresscity"/>',
                width: 120
            },
            {
                field: "addressZone",
                title: '<@spring.message "concact.addresszone"/>',
                width: 120
            },
            {
                field: "addressZipCode",
                title: '<@spring.message "concact.postcodes"/>',
                width: 120
            },
            {
                field: "addressDetails",
                title: '<@spring.message "concact.detailedaddress"/>',
                width: 120
            }
        ],
        editable: true
    });

</script>
</body>
</html>